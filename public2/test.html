<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê²Œì‹œê¸€ API í…ŒìŠ¤íŠ¸</title>
</head>
<body>
    <h1>ğŸ” ë¡œê·¸ì¸ & ê²Œì‹œê¸€ API í…ŒìŠ¤íŠ¸</h1>

    <h2>ğŸ‘¤ íšŒì›ê°€ì…</h2>
    <input type="text" id="registerUsername" placeholder="ì•„ì´ë””"><br>
    <input type="email" id="registerEmail" placeholder="ì´ë©”ì¼"><br>
    <input type="password" id="registerPassword" placeholder="ë¹„ë°€ë²ˆí˜¸"><br>
    <button onclick="register()">íšŒì›ê°€ì…</button>

    <h2>ğŸ”‘ ë¡œê·¸ì¸</h2>
    <input type="email" id="loginEmail" placeholder="ì´ë©”ì¼"><br>
    <input type="password" id="loginPassword" placeholder="ë¹„ë°€ë²ˆí˜¸"><br>
    <button onclick="login()">ë¡œê·¸ì¸</button>
    <p id="loginStatus"></p>

    <h2>ğŸ“ ê²Œì‹œê¸€ ì‘ì„±</h2>
    <input type="text" id="title" placeholder="ì œëª©"><br>
    <textarea id="content" placeholder="ë‚´ìš©"></textarea><br>
    <input type="text" id="hashtags" placeholder="í•´ì‹œíƒœê·¸ (ì‰¼í‘œë¡œ êµ¬ë¶„)"><br>
    <input type="file" id="image"><br>
    <button onclick="createPost()">ê²Œì‹œê¸€ ì‘ì„±</button>

    <h2>ğŸ“‹ ê²Œì‹œê¸€ ëª©ë¡ ì¡°íšŒ</h2>
    <button onclick="getAllPosts()">ëª¨ë“  ê²Œì‹œê¸€ ê°€ì ¸ì˜¤ê¸°</button>
    <ul id="postList"></ul>

    <h2>ğŸ” ê²Œì‹œê¸€ ê²€ìƒ‰</h2>
    <input type="text" id="searchKeyword" placeholder="ê²€ìƒ‰ì–´ ì…ë ¥">
    <button onclick="searchPosts()">ê²€ìƒ‰</button>
    <ul id="searchResults"></ul>

    <h2>ğŸ“ íŠ¹ì • ê²Œì‹œê¸€ ì¡°íšŒ</h2>
    <input type="text" id="postId" placeholder="ê²Œì‹œê¸€ ID">
    <button onclick="getPostById()">ì¡°íšŒ</button>
    <div id="postDetail"></div>

    <h2>âœï¸ ê²Œì‹œê¸€ ìˆ˜ì •</h2>
    <input type="text" id="editId" placeholder="ìˆ˜ì •í•  ê²Œì‹œê¸€ ID"><br>
    <input type="text" id="editTitle" placeholder="ìƒˆ ì œëª©"><br>
    <textarea id="editContent" placeholder="ìƒˆ ë‚´ìš©"></textarea><br>
    <input type="file" id="editImage"><br>
    <label><input type="checkbox" id="removeImage"> ê¸°ì¡´ ì´ë¯¸ì§€ ì‚­ì œ</label><br>
    <button onclick="updatePost()">ìˆ˜ì •</button>

    <h2>ğŸ—‘ ê²Œì‹œê¸€ ì‚­ì œ</h2>
    <input type="text" id="deleteId" placeholder="ì‚­ì œí•  ê²Œì‹œê¸€ ID">
    <button onclick="deletePost()">ì‚­ì œ</button>

    <script>
        const API_BASE_URL = "http://localhost:5000"; // ë°±ì—”ë“œ API ì£¼ì†Œ

        function setToken(token) { localStorage.setItem("jwt", token); }
        function getToken() { return localStorage.getItem("jwt"); }

        async function register() {
            const username = document.getElementById("registerUsername").value;
            const email = document.getElementById("registerEmail").value;
            const password = document.getElementById("registerPassword").value;

            const response = await fetch(`${API_BASE_URL}/auth/join`, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ username, email, password })
            });

            alert((await response.json()).message);
        }

        async function login() {
            const email = document.getElementById("loginEmail").value;
            const password = document.getElementById("loginPassword").value;

            const response = await fetch(`${API_BASE_URL}/auth/login`, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ email, password })
            });

            const result = await response.json();
            if (result.token) {
                setToken(result.token);
                document.getElementById("loginStatus").innerText = "âœ… ë¡œê·¸ì¸ ì„±ê³µ!";
            } else {
                document.getElementById("loginStatus").innerText = "âŒ ë¡œê·¸ì¸ ì‹¤íŒ¨!";
            }
        }

        async function createPost() {
            if (!getToken()) return alert("ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.");

            const formData = new FormData();
            formData.append("title", document.getElementById("title").value);
            formData.append("content", document.getElementById("content").value);
            formData.append("hashtags", JSON.stringify(document.getElementById("hashtags").value.split(",")));
            const image = document.getElementById("image").files[0];
            if (image) formData.append("image", image);

            const response = await fetch(`${API_BASE_URL}/posts`, {
                method: "POST",
                headers: { "Authorization": `Bearer ${getToken()}` },
                body: formData
            });

            alert((await response.json()).message);
        }

        async function getAllPosts() {
            const response = await fetch(`${API_BASE_URL}/posts`);
            const posts = await response.json();
            document.getElementById("postList").innerHTML = posts.map(post =>
                `<li>${post.id}: ${post.title} <img src="${post.image_url}" width="100"></li>`).join("");
        }

        async function getPostById() {
            const id = document.getElementById("postId").value;
            const response = await fetch(`${API_BASE_URL}/posts/${id}`);
            const post = await response.json();

            document.getElementById("postDetail").innerHTML =
                `<h3>${post.title}</h3><p>${post.content}</p><img src="${post.image_url}" width="200">`;
        }
        async function searchPosts() {
    const keyword = document.getElementById("searchKeyword").value;
    if (!keyword) {
        alert("ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš”.");
        return;
    }

    const response = await fetch(`${API_BASE_URL}/posts/search?keyword=${encodeURIComponent(keyword)}`);
    const results = await response.json();

    const searchResults = document.getElementById("searchResults");
    searchResults.innerHTML = results.length > 0
        ? results.map(post => `<li>${post.id}: ${post.title} <img src="${post.image_url || ''}" width="100"></li>`).join("")
        : "<p>ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</p>";
}

        async function updatePost() {
            if (!getToken()) return alert("ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.");

            const formData = new FormData();
            formData.append("title", document.getElementById("editTitle").value);
            formData.append("content", document.getElementById("editContent").value);
            if (document.getElementById("removeImage").checked) formData.append("removeImage", "true");
            const newImage = document.getElementById("editImage").files[0];
            if (newImage) formData.append("image", newImage);

            const id = document.getElementById("editId").value;
            const response = await fetch(`${API_BASE_URL}/posts/${id}`, {
                method: "PUT",
                headers: { "Authorization": `Bearer ${getToken()}` },
                body: formData
            });

            alert((await response.json()).message);
        }

        async function deletePost() {
            if (!getToken()) return alert("ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.");
            const id = document.getElementById("deleteId").value;

            const response = await fetch(`${API_BASE_URL}/posts/${id}`, {
                method: "DELETE",
                headers: { "Authorization": `Bearer ${getToken()}` }
            });

            alert((await response.json()).message);
        }
    </script>
</body>
</html>
